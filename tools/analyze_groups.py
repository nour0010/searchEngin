import json, re
from collections import defaultdict

# load db
p = 'emojiDatabase.json'
with open(p, 'r', encoding='utf-8') as f:
    db = json.load(f)

keys = list(db.keys())
bases = [re.sub(r'_(\d+)$', '', k) for k in keys]
unique_bases = list(dict.fromkeys(bases))

# categories (must mirror script.js)
CATS = [
    ('people_faces', ['ğŸ˜€','ğŸ˜','ğŸ˜‚','ğŸ¤£','ğŸ˜ƒ','ğŸ˜„','ğŸ˜…','ğŸ˜†','ğŸ˜‰','ğŸ˜Š','ğŸ˜‹','ğŸ˜','ğŸ˜','ğŸ˜˜','ğŸ™‚','ğŸ™ƒ','ğŸ¤—','ğŸ¤”','ğŸ¤¨','ğŸ˜','ğŸ˜‘','ğŸ˜¶','ğŸ™„','ğŸ˜','ğŸ˜£','ğŸ˜¥','ğŸ˜®','ğŸ¤','ğŸ¤‘','ğŸ¤’','ğŸ¤•','ğŸ¤¢','ğŸ¤®','ğŸ¤§','ğŸ¥µ','ğŸ¥¶','ğŸ¥´','ğŸ˜µ','ğŸ¤¯','ğŸ¤ ','ğŸ¥³','ğŸ˜‡','ğŸ¤“']),
    ('people_activity', ['ğŸ§‘','ğŸ‘¨','ğŸ‘©','ğŸ‘¶','ğŸ§“','ğŸ‘µ','ğŸ‘´','ğŸ§‘â€ğŸ«','ğŸ§‘â€âš•ï¸','ğŸ§‘â€ğŸ’»','ğŸ§‘â€ğŸ”§','ğŸ§‘â€ğŸ³','ğŸ§‘â€ğŸ¨','ğŸ§˜']),
    ('animals', ['ğŸ¶','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¨','ğŸ¯','ğŸ¦','ğŸ®','ğŸ·','ğŸµ','ğŸ¸','ğŸ”','ğŸ§','ğŸ¦','ğŸ­','ğŸ¼']),
    ('food', ['ğŸ”','ğŸ•','ğŸ£','ğŸœ','ğŸ©','ğŸª','ğŸ¥','ğŸ³','ğŸŒ¶ï¸','ğŸ§‚','ğŸ¥©','ğŸ¤','ğŸŸ','ğŸŒ­','ğŸ¥ª','ğŸŒ®','ğŸŒ¯','ğŸ¥—','ğŸ¥˜','ğŸ','ğŸ±','ğŸ›','ğŸ²','ğŸ°','â˜•','ğŸµ','ğŸº','ğŸ·','ğŸ','ğŸ‡','ğŸŒ','ğŸ¥‘','ğŸ“','ğŸ‰','ğŸ’','ğŸ','ğŸ¥','ğŸ…','ğŸ†','ğŸ¥¦','ğŸ¥¬','ğŸŒ½','ğŸ¥•','ğŸ','ğŸ','ğŸŠ','ğŸ‹','ğŸ§€','ğŸ¥–','ğŸ¥']),
    ('sports', ['âš½','ğŸ€','ğŸˆ','ğŸ¾','ğŸŠ','ğŸ','ğŸ‰','ğŸ±','ğŸ“','ğŸ¸','ğŸ‚','â›·ï¸','ğŸ¥Š','ğŸ‹ï¸']),
    ('travel', ['ğŸš—','âœˆï¸','ğŸš†','ğŸš²','ğŸšŒ','ğŸš¤','ğŸš€','ğŸ›³ï¸','ğŸš¢','ğŸ—ºï¸','ğŸ–ï¸','ğŸ”ï¸','ğŸ•ï¸','ğŸï¸','ğŸï¸','ğŸŸï¸','ğŸ›ï¸','â›º','ğŸª‚','ğŸ›¶']),
    ('places', ['ğŸ ','ğŸ¡','ğŸ¢','ğŸ£','ğŸ¥','ğŸ¦','ğŸ¨','ğŸª','ğŸ«','â›ª','ğŸ•Œ','ğŸ›•','ğŸ›ï¸']),
    ('entertainment', ['ğŸ®','ğŸ§','ğŸ¸','ğŸ¤','ğŸ¬','ğŸ¨','ğŸ­','ğŸ¹','ğŸµ','ğŸ¶']),
    ('objects', ['ğŸ“±','ğŸ’»','ğŸ–¨ï¸','ğŸ–±ï¸','ğŸ“š','ğŸ§¾','ğŸ“','ğŸ”','ğŸ’¼','ğŸ””','ğŸ”•','ğŸ“·','ğŸ¥','ğŸ“º','ğŸ“»','ğŸ','ğŸ•¯ï¸','ğŸ’Š','ğŸ©º']),
    ('flags', ['ğŸ‡¦ğŸ‡º','ğŸ‡ºğŸ‡¸','ğŸ‡¬ğŸ‡§','ğŸ‡¨ğŸ‡¦','ğŸ‡¯ğŸ‡µ','ğŸ‡©ğŸ‡ª','ğŸ‡«ğŸ‡·','ğŸ‡®ğŸ‡³','ğŸ‡§ğŸ‡·','ğŸ‡ªğŸ‡¬','ğŸ³ï¸â€ğŸŒˆ']),
]

cat_map = {}
for name, items in CATS:
    for it in items:
        cat_map[it] = name

classified = defaultdict(list)
unclassified = []
for b in unique_bases:
    c = cat_map.get(b)
    if c:
        classified[c].append(b)
    else:
        unclassified.append(b)

print('uniqueBasesCount:', len(unique_bases))
for name,_ in CATS:
    print(f"\n{name}: {len(classified[name])} items")
print('\nUnclassified count:', len(unclassified))
if unclassified:
    print('\nUnclassified examples (first 120):')
    for e in unclassified[:120]: print(e)
