import json
import re
from pathlib import Path

ROOT = Path(__file__).parent
DB_PATH = ROOT / 'emojiDatabase.json'
OUT_PATH = ROOT / 'emojiDatabase.json'
BACKUP_PATH = ROOT / 'emojiDatabase.backup.json'

with DB_PATH.open('r', encoding='utf-8') as f:
    data = json.load(f)

# backup
with BACKUP_PATH.open('w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

print('Loaded', len(data), 'entries from', DB_PATH)

# category lists (common emojis present in DB)
food = set(list("๐๐๐ฃ๐๐ฉ๐ช๐ฅ๐ณ๐ถ๏ธ๐ง๐ฅฉ๐ค๐๐ญ๐ฅช๐ฎ๐ฏ๐ฅ๐ฅ๐๐ฑ๐๐ฒ๐ฐโ๐ต๐บ๐ท๐๐๐๐ฅ๐ช๐๐๐๐๐ฅ"))
transport = set(list("๐โ๏ธ๐๐ฒ๐๐ค๐๐ณ๏ธ๐ข๐๐ฒ"))
travel = set(list("๐บ๏ธ๐จ๐๏ธ๐๏ธ๐๏ธ๐๏ธ๐๏ธ๐๏ธ๐๏ธ๐๏ธ๐ญ๐ข๐ฌ๐ฃ๐ค๐ฅ๐ฆ๐จ"))
sports = set(list("โฝ๐๐๐พ๐๐๐๐๐๐ธ๐ฏ๐ณ๐"))
animals = set(list("๐ถ๐ฑ๐ญ๐น๐ฐ๐ฆ๐ป๐ผ๐จ๐ฏ๐ฆ๐ฎ๐ท๐ต๐ธ๐๐ง๐ฆ"))
people_faces = set(list("๐๐๐๐คฃ๐๐๐๐๐๐๐๐๐๐๐๐๐ค๐ค๐คจ๐๐๐ถ๐๐๐ฃ๐ฅ๐ฎ๐ค๐ค๐ค๐ค๐คข๐คฎ๐คง๐ฅต๐ฅถ๐ฅด๐ต๐คฏ๐ค๐ฅณ๐๐ค"))
objects = set(list("๐ฑ๐ป๐จ๏ธ๐ฑ๏ธ๐๐งพ๐๐โ๏ธโค๏ธ๐๐๐๐ฏ๏ธ๐๐ฉบ๐ผ๐๐๐ท๐ฅ๐บ๐ป๐ง๐ฎ"))
flags = set(list("๐ฆ๐บ๐บ๐ธ๐ฌ๐ง๐จ๐ฆ๐ฏ๐ต๐ฉ๐ช๐ซ๐ท๐ฎ๐ณ๐ง๐ท๐ช๐ฌ๐ณ๏ธโ๐"))
places = set(list("๐๐ก๐ข๐ฃ๐ฅ๐ฆ๐จ๐ช๐ซโช๐๐๐๏ธ๐๏ธ"))

# generic templates
fallback_templates = [
    lambda e: f"ูุนูููุงุช ุนู {e}",
    lambda e: f"ุงูุชุฑุงุญุงุช ูุฑุชุจุทุฉ ุจู {e}",
    lambda e: f"ุฏููู {e} โ ุฃูุงูู ููุตูุงุช ููุตุงุฆุญ"
]

# maps for specific emojis to recommended suggestion arrays
manual_map = {
    'โ๏ธ': ["ุชุญุฐูุฑุงุช ุนุงูุฉ", "ุฅุดุนุงุฑุงุช ุฃูุงู", "ุชุญุฏูุซุงุช ุนุงุฌูุฉ"],
    '๐': ["ุฃูุถู ูุทุงุนู ุงูุจุฑุฌุฑ", "ูุตูุงุช ุจุฑุฌุฑ ููุฒููุฉ", "ุชุนูููุงุช ูุชููููุงุช ูุทุงุนู ุงูุจุฑุฌุฑ"],
    '๐': ["ุฃูุถู ุจูุชุฒุง ูู ุงูุฌูุงุฑ", "ูุตูุงุช ุจูุชุฒุง ููุฒููุฉ", "ุฏููู ูุทุงุจุฎ ุงูุจูุชุฒุง ุงููุญููุฉ"],
    '๐ฃ': ["ูุทุงุนู ุณูุดู ููุซููุฉ", "ูุตูุงุช ุณูุดู ุณููุฉ", "ุชููููุงุช ูุชูุตูุงุช ููุณูุดู"],
    'โ': ["ุฃูุถู ุงูููุงูู ุงููุฑูุจุฉ", "ุทุฑู ุชุญุถูุฑ ุงููููุฉ ุงูููุฒููุฉ", "ุฃููุงุน ุญุจูุจ ุงููููุฉ"],
    '๐ฉ': ["ูุญูุงุช ุญูููุงุช ูุฑูุจุฉ", "ูุตูุงุช ุฏููุงุช ููุฒููุฉ", "ุญูููุงุช ููุญููุงุช"],
    '๐': ["ูุตุงุฆุญ ุตูุงูุฉ ุงูุณูุงุฑุฉ", "ูุญูุงุช ุชุบููุฑ ุงูุฒูุช ูุงููุณุงุฆู", "ุชุฃุฌูุฑ ุณูุงุฑุงุช ูุญูู"] ,
    'โ๏ธ': ["ุญุฌุฒ ุทูุฑุงู ุฑุฎูุต", "ูุชุทูุจุงุช ุงูุณูุฑ ุงูุฏูููุฉ", "ุฃูุถู ูุฌูุงุช ุงูุณูุฑ"] ,
    '๐จ': ["ููุงุฏู ููุตู ุจูุง", "ุนุฑูุถ ุญุฌุฒ ุงูููุงุฏู", "ุชููููุงุช ุงูุฅูุงูุฉ"] ,
    '๐๏ธ': ["ุดูุงุทุฆ ูุฑูุจุฉ ููุนุงุฆูุฉ", "ุฃูุดุทุฉ ูุงุฆูุฉ", "ูุตุงุฆุญ ุงูุณูุงูุฉ ุนูู ุงูุดุงุทุฆ"] ,
    'โฝ': ["ูุชุงุฆุฌ ูุจุงุฑูุงุช ุงูููู", "ุฌุฏูู ุงูุฏูุฑู ุงููุญูู", "ุฃุฎุจุงุฑ ูุฑุฉ ุงููุฏู"] ,
    '๐ฎ': ["ุฃุญุฏุซ ุงูุฃูุนุงุจ", "ูุฑุงุฌุนุงุช ุฃูุนุงุจ", "ุนุฑูุถ ุชูุฒูู ุงูุฃูุนุงุจ"] ,
    '๐ฑ': ["ุฃุญุฏุซ ููุงุชู ุงูุณูู", "ููุงุฑูุงุช ููุงุตูุงุช ุงูููุงุชู", "ุนุฑูุถ ุดุฑุงุก ููุงุชู"] ,
    '๐ป': ["ุฃูุถู ูุงุจุชูุจุงุช ููุนูู", "ูุตุงุฆุญ ุตูุงูุฉ ุงูุญุงุณูุจ", "ุงุฎุชูุงุฑุงุช ูููุจุฑูุฌูู"] ,
    '๐': ["ููุชุฑุญุงุช ูููุฑุงุกุฉ", "ููุฎุตุงุช ูุชุจ ูุดููุฑุฉ", "ุฃูู ุฃุฌุฏ ูุชุจ ูุฌุงููุฉ"] ,
    '๐ถ': ["ุชุจูู ููุงุจ ูุญูููุง", "ุฑุนุงูุฉ ูุชุบุฐูุฉ ุงูููุงุจ", "ุชุฏุฑูุจ ุงูููุงุจ ูููุจุชุฏุฆูู"] ,
    '๐ฑ': ["ุฑุนุงูุฉ ุงููุทุท", "ุชุทุนููุงุช ููุตุงุฆุญ ุตุญูุฉ", "ุฃุบุฐูุฉ ููุชุฑุญุฉ ูููุทุท"] ,
    '๐ฅ': ["ุชุญุฐูุฑุงุช ุญุฑุงุฆู", "ุฅุฑุดุงุฏุงุช ุงูุณูุงูุฉ ูู ุงูุญุฑูู", "ูุนุฏุงุช ุฅุทูุงุก ููุตู ุจูุง"] ,
    '๐': ["ุฃููุงุฑ ุญููุงุช", "ุฏูููุฑุงุช ุจุณูุทุฉ ููุญููุงุช", "ููุงุฆู ุชุดุบูู ููุญููุงุช"] ,
    '๐': ["ูุญูุงุช ููู ูููุฒุฉ", "ูุตูุงุช ููู ููุฒููุฉ", "ุชุฒููู ุงููุนู ุฎุทูุฉ ุจุฎุทูุฉ"] ,
    '๐': ["ูุนูููุงุช ุนู ุงูุฃุฏููุฉ ุงูุดุงุฆุนุฉ", "ูุชู ุชุฒูุฑ ุงูุทุจูุจ", "ุฃุนุฑุงุถ ุดุงุฆุนุฉ ูููููุฉ ุงูุชุนุงูู ูุนูุง"] ,
    '๐ฉบ': ["ุนูุงุฏุงุช ูุฑูุจุฉ", "ูุตุงุฆุญ ุตุญูุฉ ุนุงูุฉ", "ููููุฉ ุงูููุงูุฉ ูู ุงูุฃูุฑุงุถ"] ,
    '๐': ["ุจุญุซ ุจุงูุฅูููุฌู โ ุฃูุซูุฉ", "ููููุฉ ุงุณุชุฎุฏุงู ุงูุฅูููุฌู ููุจุญุซ", "ุฃูุซูุฉ ุจุญุซูุฉ ูููุฏุฉ"] ,
    '๐': ["ุฎุฏูุงุช ุนูุงุฑูุฉ ูุญููุฉ", "ูุตุงุฆุญ ูุชุฒููู ุงูููุฒู", "ุตูุงูุฉ ููุฒููุฉ ุฃุณุงุณูุฉ"] ,
    '๐ก': ["ุญุฑุงุฌ ููุงุฒู ููุจูุน", "ุฃููุงุฑ ุญุฏููุฉ ููุฒููุฉ", "ูุตุงุฆุญ ุชุฃุฌูุฑ ุงูููุฒู"] ,
    '๐ท': ["ุฃูุถู ูุงููุฑุงุช ูููุจุชุฏุฆูู", "ููุงูุน ุชุตููุฑ ุฌูููุฉ ูุญูููุง", "ูุตุงุฆุญ ุงูุชุตููุฑ ุงูููุชูุบุฑุงูู"] ,
    '๐ง': ["ููุงุฆู ุชุดุบูู ููุณูููุฉ", "ูุฑุงุฌุนุงุช ุณูุงุนุงุช", "ุนุฑูุถ ููุณูููุฉ ุญูุฉ"] ,
    '๐': ["ุฃููุงุฑ ูุฏุงูุง ุญุณุจ ุงูููุงุณุจุฉ", "ูุชุงุฌุฑ ูุฏุงูุง ููุชุฑุญุฉ", "ุชุบููู ูุฏุงูุง ุณูู ูุณุฑูุน"] ,
    '๐ซ': ["ุฏูุฑุงุช ุชุนููููุฉ ูุฑูุจุฉ", "ูุฏุงุฑุณ ูุฑูุงุถ ุฃุทูุงู", "ุฏุฑูุณ ุฎุตูุตูุฉ ููุฑุด ุนูู"] ,
    '๐ง': ["ุฑูุชููุงุช ููุบุง ูููุจุชุฏุฆูู", "ุฌูุณุงุช ุชุฃูู ูุตูุฑุฉ", "ููุงุฆุฏ ุงูุชุฃูู ููุตุญุฉ ุงูุนูููุฉ"] ,
    'โค๏ธ': ["ุนุจุงุฑุงุช ุฑููุงูุณูุฉ", "ุฃููุงุฑ ูุฏุงูุง ููุญุจูุจ", "ุฃุบุงูู ุฑููุงูุณูุฉ ููุชุฑุญุฉ"] ,
}

# function to create suggestions for a base emoji

def make_suggestions(base):
    if base in manual_map:
        return manual_map[base]
    # heuristics
    if base in food:
        return [f"ูุตูุงุช {base} ุดููุฉ", f"ูุทุงุนู ุชูุฏู {base}", f"ุทุฑู ุฅุนุฏุงุฏ {base} ุจุงูููุฒู"]
    if base in transport:
        return [f"ุญุฌูุฒุงุช ู ููุงุนูุฏ {base}", f"ูุตุงุฆุญ ุนู {base}", f"ุฎุฏูุงุช ุชุฃุฌูุฑ {base}"]
    if base in travel:
        return [f"ุฏููู ุงูุณูุฑ ูู {base}", f"ุฃูุถู ุฃูุดุทุฉ ูู {base}", f"ุญุฌูุฒุงุช ูุฅูุงูุฉ ูู {base}"]
    if base in sports:
        return [f"ุฃุฎุจุงุฑ {base}", f"ุฃูุงูู ูููุงุฑุณุฉ {base}", f"ูุจุงุฑูุงุช ูุจุทููุงุช {base}"]
    if base in animals:
        return [f"ุฑุนุงูุฉ {base}", f"ุชุจูู {base}", f"ูุนูููุงุช ุนู {base}"]
    if base in people_faces:
        return [f"ูุนุงูู ูุณูุงู {base}", f"ุงุณุชุฎุฏุงูุงุช ุดุงุฆุนุฉ ูู {base}", f"ุฑููุฒ ุชุนุจูุฑูุฉ ูุดุงุจูุฉ ูู {base}"]
    if base in objects:
        return [f"ูุนูููุงุช ุนู {base}", f"ุฃุฏูุฉ ู ูุตุงุฆุญ ูู {base}", f"ุฃูู ุฃุฌุฏ {base}ุ"]
    if base in flags:
        return [f"ูุนูููุงุช ุนู ุงูุฏููุฉ {base}", f"ุฃุฎุจุงุฑ ูููุงุณุจุงุช ูู ุงูุจูุฏ", f"ููุงููู ุงูุณูุฑ ููุจูุฏ ุงููุฑุชุจุท ุจู {base}"]
    if base in places:
        return [f"ูุนูููุงุช ุนู {base}", f"ุฃูุดุทุฉ ููุชุฑุญุฉ ูู {base}", f"ุฎุฏูุงุช ูุฑูุจุฉ ูู {base}"]
    # fallback
    return [t(base) for t in fallback_templates]

# Replace entries
new_data = {}
pattern = re.compile(r'_(\d+)$')
replaced = 0
for key, val in data.items():
    base = pattern.sub('', key)
    is_placeholder = False
    try:
        is_placeholder = all(isinstance(s, str) and re.search(r'ุงูุชุฑุงุญ\s*\d+', s) for s in val)
    except Exception:
        is_placeholder = False
    if is_placeholder or any((isinstance(s, str) and key in s) for s in val):
        new_data[key] = make_suggestions(base)
        replaced += 1
    else:
        new_data[key] = val

print('Placeholders found and replaced:', replaced)

# write out
with OUT_PATH.open('w', encoding='utf-8') as f:
    json.dump(new_data, f, ensure_ascii=False, indent=2)

print('Updated suggestions written to', OUT_PATH)
print('Backup saved to', BACKUP_PATH)
